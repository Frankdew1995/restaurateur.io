<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords" content=""/>
    <script src="js/jquery2.0.3.min.js"></script>
</head>
<body>
    <div id="w" style='white-space:pre'></div>
</body>
</html>
<script type="text/javascript">
    let id = getQueryString("id");
    $("document").ready(function () {
        $.ajax({
            url:"../../php/menuDataByXSTAR.php?q=getPrint3",
            data:{id,id},
            type:"POST",
            success:function (res) {
                //console.log(res);
                //绑定数据
                let types = JSON.parse(res);

                let shopInfo = types[0][0];
                let orderInfo = types[1][0];
                let list = types[2];

                let data = list[0];
                //店铺信息
                var show = "<div style='height: 30px;font-size: 20px;font-weight: bold;'> " + shopInfo['name'] + "<br/></div>" +
                           "<div style='height: 25px;'> " + shopInfo['address'] + "<br/></div>" +
                           "<div style='height: 25px;'> " + shopInfo['postcode'] + "   " + shopInfo['city'] + "<br/></div>" +
                           "<div style='height: 25px;'> " + shopInfo['tel'] + "<br/></div>";
                //订单信息
                show = show +  "********************************************************<br/>" + 
                               "<div style='height: 25px;'> " + orderInfo['ordertime'] + "<br/></div>" + 
                               "<div style='height: 25px;'> " + orderInfo['tablename'] + "<br/></div>" + 
                               "<div style='height: 25px;'> " + orderInfo['orderId'] + "<br/></div>" + 
                               " ---------------------------------------------------------<br/>";
                //订单列表
                for(var i = 0 ;i<list.length;i++){
                    let price = parseFloat(list[i]['price']);
                    if(price > 0){
                        var det = "";
                        if(list[i]['dishname'] == "Buffet" && list[i]['children'] == "yes"){
                            det = "<span style='font-size:10px;'>(kind)</span>";
                        }
                        let total = price * parseFloat(list[i]['amount']);
                        show = show + " " + list[i]['dishname'] + det + "   x " +list[i]['amount']+ " <br/>"+
                               " . . . . . . . . . . . . . . . . . . €" + list[i]['price'] + "   x "+list[i]['amount'] + "  =  €" +total + "</br>"; 
                    }
                }
                //税 价
                show = show + " ---------------------------------------------------------<br/>" + 
                              "<div style='height: 25px;'> Betrag netto:  €"+parseFloat(orderInfo['pre_tax']).toFixed(2)+ "<br/></div>" + 
                              "<div style='height: 25px;'> mit   "+ (parseFloat(orderInfo['tax']) / parseFloat(orderInfo['pre_tax']) * 100).toFixed(0)+ "%   MwSt. :   €"+parseFloat(orderInfo['tax']).toFixed(2)+"<br/></div>" + 
                              "<div style='height: 25px;'> Summe:  <br/></div>" + 
                              "<div style='height: 30px;font-size: 20px;font-weight: bold;'>    €"+parseFloat(orderInfo['amount']).toFixed(2)+ "<br/></div>" + 
                              "<div style='height: 25px;font-weight: bold;'>     "+orderInfo['paymentmethod']+ "<br/></div>" + 
                              "<div style='height: 25px;'> UmsatzsteuerID  "+shopInfo['texnumber']+ "<br/></div>" + 
                              "********************************************************<br/></div>"+
                              "<div style='height: 25px;'> Aufwiedersehen !  </div>";

                $("#w").html(show);
                window.print();
                window.close();
                //console.log(types[0]);
            }
        });
        
    });
    //获取url参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
</script>